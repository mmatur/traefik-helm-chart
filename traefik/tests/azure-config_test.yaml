suite: Traefik configuration for Azure Marketplace
templates:
  - deployment.yaml
tests:
  - it: should not set global.azure arg by default
    chart:
      appVersion: v3.3.0
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: docker.io/traefik:v3.3.0

  - it: should use global.azure with proxy when enabled
    set:
      global:
        azure:
          enabled: true
          images:
            proxy:
              tag: v3.3.5
              registry: repo.io
              image: foo
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: repo.io/foo:v3.3.5

  - it: should use global.azure with hub when enabled with token
    set:
      hub:
        token: xxx
      global:
        azure:
          enabled: true
          images:
            hub:
              tag: v3.15.0
              registry: repo.io
              image: traefik-hub
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: repo.io/traefik-hub:v3.15.0
